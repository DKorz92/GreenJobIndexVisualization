<h1>Thanks for participating in this study!</h2>
<div class="textDiv" style="text-align: center;">
    <p style="text-align:center;"> First, follow the instructions, which leads you through all the main functions of the tool.</br>
        After that, you will be guided to a short questionair.</br>
        No personal data will be stored, all answers will be treaded anonymously.</br>
        You can answer the questions in english or german and you can use floating text or short notes, as you wish.</p>
    <div id="instructionsDiv">
        <h3 id="instructionsHeader"></h2>
        <p id="instructionsText"></p>
    </div>
    <input type="text" id="textInput">
    <p class="button" id="continue">Continue</p>
</div>
<script>
    var tasks = [
        {   text:  "Selection of MSAs",
            sub:    [
                    {   text:   'Take a look at the  panel "MSA Selection". Select the MSAs "Phoenix-Mesa-Scottsdale", "Bakersfield" and "Tucson".  If you need an explanation, use the "?" button.',
                        input:  false,
                        panelID: "mapPanel",
                        check: function(){
                            var ph = false;
                            var bak = false;
                            var tus = false;
                            for(var i=0;i<g_dataState.p_selectedMSAs.length;i++){
                                if(g_dataState.p_selectedMSAs[i].code == "38060")ph = true;
                                if(g_dataState.p_selectedMSAs[i].code == "12540")bak = true;
                                if(g_dataState.p_selectedMSAs[i].code == "46060")tus = true;
                            }
                            return ph && bak && tus;
                        }
                    },
                    {   text:   'Make sure your currently selected MSA is "Phoenix-Mesa-Scottsdale"',
                        input:  false,
                        panelID: "staticMSASelection"
                    }
                ]
        },
        {   text: 'Investigation of MSAs.',
            sub:    [
                    {   text:   "Select the panel 'Greenindex comparison'",
                        input:  false,
                        panelID: "msaPanel"
                    },
                    {   text:   "What is Phoenix’s green index in the year 2015? What is it’s rank?",
                        input:  true,
                        panelID: "msaPanel"
                    },
                    {   text:   "Select the panel 'Evolution of MSAs green index'",
                        input:  false,
                        panelID: "msaOverTimePanel"
                    },
                    {   text:   "Try to describe Phoenix’ current situation relative to the both other MSAs and the development over the last years.",
                        input:  true,
                        panelID: "msaOverTimePanel"
                    }
                ]
        },
        {   text:  'Selection of occupations',
            sub:    [
                    {  text:   "Select the panel 'Occupation Selection'.",
                        input:  false,
                        panelID: "occupationGraphPanel"
                    },
                    {  text:   "Which is the occupation with the highest advantage for the green job index for Phoenix with which value? ",
                        input:  true,
                        panelID: "occupationGraphPanel"
                    },
                    {  text:   "Which is the one with the highest easiness (value, how good an occupation matches to the MSAs employment landscape)?",
                        input:  true,
                        panelID: "occupationGraphPanel"
                    },
                    {   text:   "Select the occupation which has the highest relative salary value in Phoenix compared to the whole US.",
                        input:  false,
                        panelID: "occupationGraphPanel",
                        check: function(){
                            return g_dataState.p_selectedOccupations.length>0 && g_dataState.p_selectedOccupations[0].code == "17-2161";
                        }
                    },
                    {   text:   "Select a second occupation of your choice, which could be a good start for improving Phoenix green index.",
                        input:  false,
                        panelID: "occupationGraphPanel",
                        check: function(){
                            return g_dataState.p_selectedOccupations.length == 2;
                        }
                    },
                    {   text:   "Which are your main criteria in choosing exactly this occupation?",
                        input:  true,
                        panelID: "occupationGraphPanel"
                    }
                ]
        },
        {   text:  'Selection of industries',
            sub:    [
                    {   text:   "Select the panel 'Industry Selection'.",
                        input:  false,
                        panelID: "industryPanel"
                    },
                    {   text:   "Which industry has the best suitability value for Phoenix with which value?",
                        input:  true,
                        panelID: "industryPanel"
                    },
                    {   text:   "Select the industry with the highest percentage of workers in 'Nuclear Engineers'.",
                        input:  false,
                        panelID: "industryPanel",
                        check: function(){
                            return g_dataState.p_selectedIndustries.length>0 && g_dataState.p_selectedIndustries[0].code == "221100";
                        }
                    },
                    {   text:   "Select a second industry to specialize the occupations in your selection.",
                        input:  false,
                        panelID: "industryPanel",
                        check: function(){
                            return g_dataState.p_selectedIndustries.length == 2;
                        }
                    },
                    {   text:   "Which are your main criteria in choosing exactly this industry?",
                        input:  true,
                        panelID: "industryPanel"
                    }
                ]
        },
        {   text:  'Creation of "What-If-Scenarios" ',
            sub:    [
                    {  text:   "Select the panel 'Layer creation and selection'. A 'What-If-Scenario' is in this tool called a layer.",
                        input:  false,
                        panelID: "layerPanel"
                    },
                    {  text:   "Create a new layer with your current selection.",
                        input:  false,
                        panelID: "layerPanel"
                    },
                    {  text:   "For every industry a value was calculated, how many workers your MSA has to attract. Whats the number of workers in 'Electric power generation, transmission and distribution'?",
                        input:  true,
                        panelID: "layerPanel"
                    },
                    {  text:   "By how much does the green index improve in this scenario?",
                        input:  true,
                        panelID: "msaOverTimePanel"
                    },
                    {   text:   "Do you think this „what-if“ is realistic? Have you choosen the right occupations/industries? Criterias could be number of workers, improvement of the index,...",
                        input:  true,
                        panelID: "layerPanel"
                    },
                    {   text:   "What would be interesting to try next?",
                        input:  true
                    },
                    {   text:   "Do you think, that this contemplation has relevance in the reality?",
                        input:  true
                    },
                    {   text:   "Are there any aspects that you consider missing from this analysis?",
                        input:  true
                    }
                ]
        }
        ];
        /*var selection = d3.select("#instructions").selectAll("div").data(tasks).enter()
            .append("div");
        selection.append("h3")
            .text(function(d,i){return (i+1)+". "+d.text})
            .attr("id",function(d,i){return "chapter"+i})
            .style("font-size","0");
        selection.selectAll("p").data(function(d){return d.sub;}).enter()
            .append("p")
                .text(function(d,i){return (i+1)+". "+d.text;})
                .attr("class",function(d,i){return "sektion"+i})
                .style("font-size","0");*/

        d3.select("#continue").on("click",nextInstruction);
        d3.select("#textInput")
            .style("width","100%")
            .style("padding","10px")
            .style("border-radius","40px");
        var chapter = -1;
        var sektion = -1;
        nextInstruction();

        function taskCheck(){
            if(sektion>=0 && chapter>=0){
                if(tasks[chapter].sub[sektion].check){
                    if(tasks[chapter].sub[sektion].check() && !tasks[chapter].sub[sektion].done){
                        alert("Well done! You can continue.")
                        tasks[chapter].sub[sektion].done = true;
                    }
                }
            }

        }

        function nextInstruction(){
            var chaptertext = "";
            var sektiontext = "";
            if(chapter < 0){
                chapter = 0;
                chaptertext = (chapter+1)+". "+tasks[chapter].text;
                d3.select("#textInput").style("visibility","hidden");
            }
            else if(tasks[chapter].sub.length == sektion+1){
                if(tasks[chapter].sub[sektion].panelID){
                    d3.select("#"+tasks[chapter].sub[sektion].panelID).style("background",null);
                }
                tasks[chapter].sub[sektion].answer = d3.select("#textInput").property("value");
                    d3.select("#textInput").property("value","");
                chapter++;
                if(chapter == tasks.length){
                    showQuest();
                    return;
                }
                sektion = -1;
                chaptertext = (chapter+1)+". "+tasks[chapter].text;
                d3.select("#textInput").style("visibility","hidden");
            }else{
                if(sektion>=0){
                    if(tasks[chapter].sub[sektion].panelID){
                        d3.select("#"+tasks[chapter].sub[sektion].panelID).style("background",null);
                    }
                    tasks[chapter].sub[sektion].answer = d3.select("#textInput").property("value");
                    d3.select("#textInput").property("value","");
                }
                sektion ++;
                chaptertext = (chapter+1)+". "+tasks[chapter].text;
                sektiontext = (chapter+1)+"."+(sektion+1)+". "+tasks[chapter].sub[sektion].text;
                if(tasks[chapter].sub[sektion].panelID)
                    d3.select("#"+tasks[chapter].sub[sektion].panelID).style("background","#dfb1b1");
                if(tasks[chapter].sub[sektion].input)
                    d3.select("#textInput").style("visibility","visible");
                else
                    d3.select("#textInput").style("visibility","hidden");
            }
            d3.select("#instructionsHeader").text(chaptertext);
            d3.select("#instructionsText").text(sektiontext);

        }
        function showQuest(){
            d3.select("#toolDiv").remove();
            d3.select("#questDiv").style("visibility","visible");
            d3.select("#questHeader").style("visibility","visible");
        }
</script>